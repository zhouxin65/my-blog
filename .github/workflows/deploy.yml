# name å¯ä»¥è‡ªå®šä¹‰
name: Deploy my blog

# è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° main/master åˆ†æ”¯åï¼Œæ–°çš„ Github é¡¹ç›® åº”è¯¥éƒ½æ˜¯ mainï¼Œè€Œä¹‹å‰çš„é¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯ master
on:
  push:
    branches:
      - main
# ä»»åŠ¡
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # æ‹‰å–ä»£ç 
      - name: Checkout
        uses: actions/checkout@v2
        with:
          # â€œæœ€è¿‘æ›´æ–°æ—¶é—´â€ ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
          fetch-depth: 2
          # persist-credentials: false

      - name: Use Node.js
        uses: actions/setup-node@v2.5.1 # ä½¿ç”¨nodeç¯å¢ƒ
        with:
          node-version: 18.18.0 # ç‰ˆæœ¬

      - name: Cache node modules
        id: cache # ç¼“å­˜id
        uses: actions/cache@v3
        env:
          cache-name: cache-node-modules # ç¼“å­˜åå­—
        with:
          path: node_modules # ç¼“å­˜è·¯å¾„
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('package.json') }} # ç¼“å­˜æ ‡è¯†

      - name: Install Dependencies
        if: steps.cache.outputs.cache-hit != 'true' # å¦‚æœæ²¡æœ‰ç¼“å­˜çš„è¯
        run: yarn & npm install # å®‰è£…ä¾èµ–

      # ç”Ÿæˆé™æ€æ–‡ä»¶
      - name: ğŸ”¨ Build Project
        run: |
          yarn build
          npm run build

      # å¦‚æœFTP-Deploy-Actionå‡ºç°ï¼ŒDirty repository: Having uncommitted changes. é—®é¢˜æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ³¨é‡Šæ­¥éª¤è§£å†³é—®é¢˜
      - name: reset git
        run: git reset --hard

      - name: ğŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.3.3
        with:
          server: ${{ secrets.FTP_IP }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: dist/ # é€‰æ‹©å“ªäº›æ–‡ä»¶è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨è¿™é‡Œé€‰äº†ä¹‹åï¼Œè¦åœ¨.git-ftp-includeä¸­æ·»åŠ ç›¸åº”çš„è·¯å¾„
          server-dir: /
          dangerous-clean-slate: true

      #           ftp-server: sftp://${{ secrets.FTP_IP }}/home/www/htdocs # æœåŠ¡å™¨åœ°å€å’Œç«¯å£ï¼ˆå¯ä»¥å¡«åŸŸåï¼Œä¸è¿‡æˆ‘æœåŠ¡å™¨åšäº†å…¨ç«™åŠ é€Ÿä¼šå¯¼å‘åŠ é€Ÿç»“ç‚¹çš„IPï¼Œæ‰€ä»¥åªèƒ½ç”¨æœåŠ¡å™¨çš„IPï¼‰
      #           ftp-username: ${{ secrets.FTP_USERNAME }} # FTPç”¨æˆ·å
      #           ftp-password: ${{ secrets.FTP_PASSWORD }} # FTPå¯†ç 
      #           git-ftp-args: --insecure # ï¼ˆå¦‚æœæ˜¯FTPè¿æ¥çš„è¯--insecureä¸ç”¨åŠ ï¼‰
      #           local-dir: docs/.vuepress/dist/ # é€‰æ‹©å“ªäº›æ–‡ä»¶è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨è¿™é‡Œé€‰äº†ä¹‹åï¼Œè¦åœ¨.git-ftp-includeä¸­æ·»åŠ ç›¸åº”çš„è·¯å¾„

      - name: upload-artifact
        uses: actions/upload-artifact@v3 #å…±äº«æˆ–ä¿å­˜actionè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–‡ä»¶
        with:
          name: static_web_file
          path: ./dist/ # or path/to/artifact