# name å¯ä»¥è‡ªå®šä¹‰
name: Deploy my blog

# è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° main/master åˆ†æ”¯åï¼Œæ–°çš„ Github é¡¹ç›® åº”è¯¥éƒ½æ˜¯ mainï¼Œè€Œä¹‹å‰çš„é¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯ master
on:
  push:
    branches:
      - main
# ä»»åŠ¡
jobs:
  build-and-deploy:
    # æœåŠ¡å™¨ç¯å¢ƒï¼šcentos 7.9
    runs-on: centos-7.9
    steps:
      # æ‹‰å–ä»£ç 
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      # å®‰è£…ä¾èµ–
      - name: Install Dependencies
        run: npm install

      # ç”Ÿæˆé™æ€æ–‡ä»¶
      - name: ğŸ”¨ Build Project 
        run: npm run docs:build
        #env:
        #  LEANCLOUD_APP_ID: ${{ secrets.LEANCLOUD_APP_ID }} # è¯„ è®ºç³»ç»Ÿçš„ID
        #  LEANCLOUD_APP_KEY: ${{ secrets.LEANCLOUD_APP_KEY }} # è¯„è®ºç³»ç»Ÿçš„KEY

      # å¦‚æœFTP-Deploy-Actionå‡ºç°ï¼ŒDirty repository: Having uncommitted changes. é—®é¢˜æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ³¨é‡Šæ­¥éª¤è§£å†³é—®é¢˜
      - name: reset git
        run: git reset --hard

      - name: ğŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.3.3
        with:
          server: ${{ secrets.FTP_IP }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: docs/.vuepress/dist/ # é€‰æ‹©å“ªäº›æ–‡ä»¶è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨è¿™é‡Œé€‰äº†ä¹‹åï¼Œè¦åœ¨.git-ftp-includeä¸­æ·»åŠ ç›¸åº”çš„è·¯å¾„
          server-dir: /

      #           ftp-server: sftp://${{ secrets.FTP_IP }}/home/www/htdocs # æœåŠ¡å™¨åœ°å€å’Œç«¯å£ï¼ˆå¯ä»¥å¡«åŸŸåï¼Œä¸è¿‡æˆ‘æœåŠ¡å™¨åšäº†å…¨ç«™åŠ é€Ÿä¼šå¯¼å‘åŠ é€Ÿç»“ç‚¹çš„IPï¼Œæ‰€ä»¥åªèƒ½ç”¨æœåŠ¡å™¨çš„IPï¼‰
      #           ftp-username: ${{ secrets.FTP_USERNAME }} # FTPç”¨æˆ·å
      #           ftp-password: ${{ secrets.FTP_PASSWORD }} # FTPå¯†ç 
      #           git-ftp-args: --insecure # ï¼ˆå¦‚æœæ˜¯FTPè¿æ¥çš„è¯--insecureä¸ç”¨åŠ ï¼‰
      #           local-dir: docs/.vuepress/dist/ # é€‰æ‹©å“ªäº›æ–‡ä»¶è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œè¿™ä¸ªé€‰é¡¹åœ¨è¿™é‡Œé€‰äº†ä¹‹åï¼Œè¦åœ¨.git-ftp-includeä¸­æ·»åŠ ç›¸åº”çš„è·¯å¾„

      - name: upload-artifact
        uses: actions/upload-artifact@v3 #å…±äº«æˆ–ä¿å­˜actionè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–‡ä»¶
        with:
          name: static_web_file
          path: ./docs/.vuepress/dist/ # or path/to/artifact

      # éƒ¨ç½²åˆ° GitHub Pages
      # - name: Deploy
      #   uses: JamesIves/github-pages-deploy-action@releases/v3
      #   with:
      #     ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }} # ä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„ secret
      #     BRANCH: gh-pages # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯ï¼Œå› ä¸º main åˆ†æ”¯å­˜æ”¾çš„ä¸€èˆ¬æ˜¯æºç ï¼Œè€Œ gh-pages åˆ†æ”¯åˆ™ç”¨æ¥å­˜æ”¾ç”Ÿæˆçš„é™æ€æ–‡ä»¶
      #     FOLDER: docs/.vuepress/dist # vuepress ç”Ÿæˆçš„é™æ€æ–‡ä»¶å­˜æ”¾çš„åœ°æ–¹
